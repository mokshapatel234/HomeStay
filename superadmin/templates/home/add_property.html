{% extends 'layouts/base.html' %}

{% block head %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

{% endblock head %}

{% block title %} Profile {% endblock title %}

{% block content %}


<!-- Page content -->
    <div class="col-xl-12">
      <div class="card">
        <div class="card-header">
          <div class="row align-items-center">
            <div class="col-8">
              <h3 class="mb-0">Property Management</h3>
            </div>
           
          </div>
        </div>
        <div class="card-body">
          <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {% if msg %}
                <p class="text-danger"> *{{msg}} </p>
              {% endif %}
            <h6 class="heading-small text-muted mb-4">Property information</h6>
            <div class="pl-lg-4">                            
                <div class="row">
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" for="input-first-name"> Property Name*</label>
                      <input type="text" id="input-first-name" class="form-control" placeholder="Property Name" name="property_name" required>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" for="input-images">Root Image*</label>
                      <input type="file" multiple id="input-images" class="form-control" placeholder="Images" name="root_image" required>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group" id="image-preview">
                      <label class="form-control-label" for="input-images"> Images*</label>
                      <input type="file" multiple id="input-images" class="form-control" placeholder="Images" name="images" required>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="form-group" id="video-preview">
                      <label class="form-control-label" for="input-videos">Videos*</label>
                      <input type="file" multiple id="input-videos" class="form-control" placeholder="Videos" name="videos" required>
                    </div>
                  </div>
                  
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label">Owner*</label>
                      <select name="owner" class="form-control select2" style="height: 3rem;">
                        <option value=""></option>
                        {% for client in clients %}
                          <option value="{{ client.id }}">{{ client.first_name }} {{ client.last_name }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>

                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" for="input-price">Price*</label>
                      <input type="text"  id="input-price" class="form-control" placeholder="Price" name="price" maxlength="5"required>
                    </div>
                  </div>
                  
                  
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label">Description*</label>
                      <textarea class="form-control" id="input_description" name="description" rows="4" cols="40" required></textarea>
                    </div>
                  </div>
                  
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label" >Address*</label>
                      <textarea class="form-control" name="address" rows="4" cols="40" required></textarea>

                    </div>
                  </div>
                   
                
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label">State*</label>
                      <select name="state" class="form-control" id="state-dropdown" style="height: 3rem;" required>
                        <option value="">Select a state</option>
                        {% for state in states %}
                          <option value="{{ state.id }}">{{ state.name }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label">City*</label>
                      <select name="city" class="form-control" id="city-dropdown" style="height: 3rem;" required disabled>
                        <option value="">Select a city</option>
                        {% for city in cities %}
                        <option value="{{ city.id }}">{{ city.name }}</option>
                      {% endfor %}
                      </select>
                    </div>
                  </div>
                  
                  <div class="col-lg-6">
                    <div class="form-group">
                      <label class="form-control-label">Area*</label>
                      <select name="area" class="form-control" id="area-dropdown" style="height: 3rem;" required disabled>
                        <option value="">Select an area</option>
                        {% for area in areas %}
                        <option value="{{ area.id }}">{{ area.name }}</option>
                      {% endfor %}
                      </select>
                      <input type="hidden" name="area" value="{{ area_id }}">
                    </div>
                  </div>
                </div>
              </div>  

                  <div>
                  <div class="col-lg-6">
                    <div class="form-group">
                    {{form.media}}
                    <label class="form-control-label" >Terms:</label>
                    {{form.terms}}
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-center">
                <button type="submit" class="btn btn-primary my-4">Submit</button>
              </div>
            </form>
        </div>
      </div>
    </div>
  </div>

 

</div>

{% endblock content %}

<!-- Specific JS goes HERE --> 
{% block javascripts %}
<!-- Specific JS goes HERE --> 
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script>
  $(document).ready(function() {
    $('select[name="owner"]').select2({
      placeholder: "Search and select an owner",
      allowClear: true,
      minimumResultsForSearch: 1
    });
  });
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

$(document).ready(function() {
  // Disable city and area dropdowns initially
  $('#city-dropdown').prop('disabled', true);
  $('#area-dropdown').prop('disabled', true);

  // Handle state dropdown change event
  $('#state-dropdown').on('change', function() {
    var selectedStateId = $(this).val();

    // Enable or disable city dropdown based on state selection
    if (selectedStateId) {
      $('#city-dropdown').prop('disabled', false);
    } else {
      $('#city-dropdown').prop('disabled', true);
      $('#area-dropdown').prop('disabled', true);
    }

    // Clear city and area dropdown values
    $('#city-dropdown').val('');
    $('#area-dropdown').val('');

    // Make an AJAX request to fetch cities based on the selected state
    $.ajax({
      url: '/get_cities/',  // Replace with your Django URL for fetching cities
      data: { state_id: selectedStateId },
      success: function(data) {
        // Clear existing city options and add new options
        $('#city-dropdown').html('<option value="">Select a city</option>');
        for (var i = 0; i < data.length; i++) {
          $('#city-dropdown').append('<option value="' + data[i].id + '">' + data[i].name + '</option>');
        }
      }
    });
  });

  // Handle city dropdown change event
  $('#city-dropdown').on('change', function() {
    var selectedCityId = $(this).val();

    // Enable or disable area dropdown based on city selection
    if (selectedCityId) {
      $('#area-dropdown').prop('disabled', false);
    } else {
      $('#area-dropdown').prop('disabled', true);
    }

    // Clear area dropdown value
    $('#area-dropdown').val('');

    // Make an AJAX request to fetch areas based on the selected city
    $.ajax({
      url: '/get_areas/',  // Replace with your Django URL for fetching areas
      data: { city_id: selectedCityId },
      success: function(data) {
        // Clear existing area options and add new options
        $('#area-dropdown').html('<option value="">Select an area</option>');
        for (var i = 0; i < data.length; i++) {
          $('#area-dropdown').append('<option value="' + data[i].id + '">' + data[i].name + '</option>');
        }
      }
    });
  });
});
</script>

{% endblock javascripts %}


